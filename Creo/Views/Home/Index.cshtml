@using Creo.ViewModels.Official
@model Creo.ViewModels.MeetingAttendance.MeetingAttendanceList

@{
	ViewBag.Title = "Home Page";
}

@section scripts {
	<script type="text/javascript">
		var map = null;
		$(document).ready(function() {


			//var map = L.map('map').setView([-39.502338, 176.887640], 14);
			//console.log('map thing ', map);
			//var latlngs = [[37, -109.05], [41, -109.03], [41, -102.05], [37, -102.04]];
			//var polygon = L.polygon(latlngs, { color: 'red' }).addTo(map);
// zoom the map to the polygon
			//map.fitBounds(polygon.getBounds());


			//var map = L.map('map').setView([-39.502338, 176.887640], 13);

			//L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			//	attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
			//}).addTo(map);

			var boundaries = {
				"type": "FeatureCollection",
				"features": [
					{
						"type": "Feature",
						"properties": {},
						"geometry": {
							"type": "Polygon",
							"coordinates": [
								[
									[
										176.8682098388672,
										-39.47085395133684
									],
									[
										176.8659782409668,
										-39.52006536051841
									],
									[
										176.9176483154297,
										-39.51397377841746
									],
									[
										176.92133903503418,
										-39.47045640920398
									],
									[
										176.8682098388672,
										-39.47085395133684
									]
								]
							]
						}
					}
				]
			}

			var geoJSONattribution =
				'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
					'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
					'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>';

			var mapboxAccessToken =
				'pk.eyJ1IjoiZ2FiZXdhcmQiLCJhIjoiY2swOHdwNXVsMDJuMDNucXI3YXNmNzVjbSJ9.KSMZisWsyb-eZMP-r-fY3w';

			map = L.map('map').setView([-39.744219, 176.430936], 7);


			L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=' + mapboxAccessToken,
				{
					id: 'mapbox.light',
					attribution: geoJSONattribution
				}).addTo(map);

			$.ajax({
				url:
					'https://datafinder.stats.govt.nz/services/query/v1/vector.json?key=dec372bbf1174dfcb85d4b0d26a2d204&layer=98753&x=176.80312333985134&y=-39.82598651618925&max_results=10&radius=30000&geometry=true&with_field_names=true',
				type: 'GET',
				dataType: 'json'
			}).done(function(result) {
				var features = [
					result.vectorQuery.layers['98753'].features[1], result.vectorQuery.layers['98753'].features[3]
				];
				result.vectorQuery.layers['98753'].features = features;
				L.geoJson(result.vectorQuery.layers['98753'], { style: style, onEachFeature: onEachFeature }).addTo(map);
			});

		});

		function onEachFeature(feature, layer) {
			layer.on({
				click: zoomToFeature
			});
		}

		function zoomToFeature(e) {
			$.ajax({
				url: '/Home/ListOfCouncillors',
				type: 'GET',
				dataType: 'html'
			}).done(function (html) {
				console.log('this is the htmo ', html);
				$('#exampleModal .modal-body').html(html);
				$('#modalTrigger').trigger('click');
			});

			map.fitBounds(e.target.getBounds());
		}

		function getColor(id) {
			if (id == 129) {
				return '#7fcdbb';
			}
			return '#2c7fb8';
		}

		function style(feature) {
			return {
				fillColor: getColor(feature.id),
				weight: 2,
				opacity: 1,
				color: 'white',
				dashArray: '3',
				fillOpacity: 0.7
			};
		}
	</script>

	<style type="text/css">
		#map {
			height: 600px;
			width: 900px;
		}
	</style>
}

<h2>Councilor Attendance</h2>

<div class="container-fluid">

	<div id="map"></div>

</div>

<button type="button" id="modalTrigger" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" style="display: none;">
	Launch demo modal
</button>

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				...
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary">Save changes</button>
			</div>
		</div>
	</div>
</div>